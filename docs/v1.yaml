openapi: 3.0.0
info:
  title: Aviatick API
  description: API for handling payments using Midtrans and fake payment validation
  version: 1.0.0
servers:
  - url: https://web-app-backend-git-development-aviaticks-projects.vercel.app/api/v1
tags:
  - name: Payments
    description: Payment operations
  - name: Bookings
    description: Booking operations

paths:
  /payments/midtrans/token/{bookingId}:
    post:
      tags:
        - Payments
      summary: Create a payment token using Midtrans
      parameters:
        - name: bookingId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                paymentMethod:
                  type: string
                  example: credit_card
      responses:
        '200':
          description: Token retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                  message:
                    type: string
                    example: Token retrieved successfully
                  data:
                    type: object
                    properties:
                      token:
                        type: string
                        example: 2304b11f-fd1f-425e-b481-ced5e3f349c6
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Invalid booking ID
                  data:
                    example: ~
        '404':
          description: Booking not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Booking Not Found With Id 100
                  data:
                    example: ~
        '500':
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Server error during token creation
                  data:
                    example: ~

  /payments/midtrans/confirm:
    post:
      tags:
        - Payments
      summary: Confirm payment using Midtrans
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                order_id:
                  type: string
                  example: 'BOOKING-1-123456789'
                transaction_id:
                  type: string
                  example: 'TRANS123'
                transaction_status:
                  type: string
                  example: 'capture'
                gross_amount:
                  type: number
                  example: 100000
                payment_type:
                  type: string
                  example: 'credit_card'
      responses:
        '200':
          description: Payment confirmed and booking status updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                  message:
                    type: string
                    example: Payment confirmed and booking status updated successfully
                  data:
                    type: object
                    properties:
                      newPaymentId:
                        type: integer
                        example: 1
                      updatedBookingId:
                        type: integer
                        example: 1
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Transaction is not successful. Status: pending"
        '500':
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Server error during payment confirmation
                  data:
                    example: ~

  /payments/payment/{bookingId}:
    post:
      tags:
        - Payments
      summary: Validate payment with credit card 
      parameters:
        - name: bookingId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                paymentMethod:
                  type: string
                  example: credit_card
                cardNumber:
                  type: string
                  example: 4515678901234
                cardHolderName:
                  type: string
                  example: John Doe
                cvv:
                  type: string
                  example: 123
                expiryDate:
                  type: string
                  example: 12/24
      responses:
        '200':
          description: Payment validated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                  message:
                    type: string
                    example: Credit card payment validated successfully
                  data:
                    type: object
                    properties:
                      booking:
                        type: object
                        properties:
                          id:
                            type: integer
                            example: 1
                          bookingCode:
                            type: string
                            example: "C8D3543BB0"
                          status:
                            type: string
                            example: "PAID"
                          expiredPaid:
                            type: string
                            format: date-time
                            example: "2024-05-28T15:34:29.303Z"
                          totalPrice:
                            type: number
                            example: 11550000
                          flightId:
                            type: integer
                            example: 5
                          userId:
                            type: integer
                            example: 1
                      payment:
                        type: object
                        properties:
                          id:
                            type: integer
                            example: 1
                          name:
                            type: string
                            example: "credit_card"
                          paidAt:
                            type: string
                            format: date-time
                            example: "2024-05-28T14:35:04.298Z"
                          bookingId:
                            type: integer
                            example: 1
        '400':
          description: Invalid Booking ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Invalid booking ID
                  data:
                    example: ~
        '404':
          description: Booking not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Booking not found
                  data:
                    example: ~
        '500':
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Server error during payment validation
                  data:
                    example: ~
  
  /bookings/new-booking:
    post:
      summary: Create a new booking
      tags: 
        - Bookings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: integer
                  example: 1
                flightId:
                  type: integer
                  example: 1
                adult:
                  type: integer
                  example: 2
                child:
                  type: integer
                  example: 0
                baby:
                  type: integer
                  example: 1
                seatClass:
                  type: integer
                  example: 1
                passenger:
                  type: array
                  items:
                    type: object
                    properties:
                      title:
                        type: string
                        example: "Mr."
                      fullName:
                        type: string
                        example: "John Doe"
                      familyName:
                        type: string
                        example: "Doe"
                      birthDate:
                        type: string
                        format: date
                        example: "1980-01-01"
                      nationality:
                        type: string
                        example: "USA"
                      identityType:
                        type: string
                        example: "Passport"
                      issuingCountry:
                        type: string
                        example: "USA"
                      identityNumber:
                        type: string
                        example: "123456789"
                      expiredDate:
                        type: string
                        format: date
                        example: "2030-01-01"
                      ageGroup:
                        type: string
                        example: "Adult"
            examples:
              createBooking:
                value:
                  userId: 1
                  flightId: 1
                  adult: 2
                  child: 0
                  baby: 1
                  seatClass: 1
                  passenger:
                    - title: "Mr."
                      fullName: "John Doe"
                      familyName: "Doe"
                      birthDate: "1980-01-01"
                      nationality: "USA"
                      identityType: "Passport"
                      issuingCountry: "USA"
                      identityNumber: "123456789"
                      expiredDate: "2030-01-01"
                      ageGroup: "Adult"
                    - title: "Mrs."
                      fullName: "Jane Doe"
                      familyName: "Doe"
                      birthDate: "1985-02-02"
                      nationality: "USA"
                      identityType: "Passport"
                      issuingCountry: "USA"
                      identityNumber: "987654321"
                      expiredDate: "2030-02-02"
                      ageGroup: "Adult"
                    - title: "Baby"
                      fullName: "Baby Doe"
                      familyName: "Doe"
                      birthDate: "2023-01-01"
                      nationality: "USA"
                      identityType: "Birth Certificate"
                      issuingCountry: "USA"
                      identityNumber: "111222333"
                      expiredDate: "2033-01-01"
                      ageGroup: "Baby"
      responses:
        200:
          description: Successfully created booking
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 'Success creating new Booking'
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 3
                      flight_id:
                        type: integer
                        example: 1
                      booking_code:
                        type: string
                        example: "1E63B67630"
                      seat_class:
                        type: integer
                        example: 1
                      total_passengers:
                        type: integer
                        example: 4
                      total_price:
                        type: number
                        example: 6600000
                      tax:
                        type: number
                        example: 600000
                      status:
                        type: string
                        example: "UNPAID"
                      paid_before:
                        type: string
                        format: date-time
                        example: "2024-05-30T16:38:51.927Z"
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Can't find user with id 1"
                  data:
                    type: object
                    nullable: true
                    example: null

  /bookings/booking-history:
    get:
      summary: Get all bookings for a user
      tags:
        - Bookings
      parameters:
        - in: query
          name: userId
          schema:
            type: integer
          required: false
          description: ID of the user
      responses:
        200:
          description: Successfully retrieved booking history
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 'Success getting booking history'
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 3
                        date:
                          type: string
                          format: date-time
                          example: "2024-06-01T08:00:00.000Z"
                        status:
                          type: string
                          example: "PAID"
                        booking_code:
                          type: string
                          example: "1E63B67630"
                        paid_before:
                          type: string
                          format: date-time
                          example: "2024-05-30T16:38:51.927Z"
                        price:
                          type: number
                          example: 6600000
                        flight_detail:
                          type: object
                          properties:
                            departure_city:
                              type: string
                              example: "New York"
                            arrival_city:
                              type: string
                              example: "Los Angeles"
                            departure_time:
                              type: string
                              format: date-time
                              example: "2024-06-01T08:00:00.000Z"
                            arrival_time:
                              type: string
                              format: date-time
                              example: "2024-06-01T12:00:00.000Z"
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Can't find user with id 2"
                  data:
                    type: object
                    nullable: true
                    example: null

  /bookings/booking-history/{bookingId}:
    get:
      summary: Get booking details
      tags:
        - Bookings
      parameters:
        - in: path
          name: bookingId
          schema:
            type: integer
          required: true
          description: ID of the booking
      responses:
        200:
          description: Successfully retrieved booking detail
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 'Success getting booking detail'
                  data:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 3
                      booking_code:
                        type: string
                        example: "1E63B67630"
                      status:
                        type: string
                        example: "PAID"
                      paid_before:
                        type: string
                        format: date-time
                        example: "2024-05-30T16:38:51.927Z"
                      flight_detail:
                        type: object
                        properties:
                          departure_city:
                            type: string
                            example: "New York"
                          arrival_city:
                            type: string
                            example: "Los Angeles"
                          departure_time:
                            type: string
                            format: date-time
                            example: "2024-06-01T08:00:00.000Z"
                          arrival_time:
                            type: string
                            format: date-time
                            example: "2024-06-01T12:00:00.000Z"
                      passengers:
                        type: array
                        properties:
                          title:
                            type: string
                            example: "Mr"
                          fullname:
                            type: string
                            example: "John Doe"
                          ktp:
                            type: string
                            example: "1234567890"
                        example:
                          - title: "Mr"
                            fullname: "John Doe"
                            ktp: "1234567890"
                          - title: "Mrs"
                            fullname: "Jane Doe"
                            ktp: "0987654321"
                          - title: "Baby"
                            fullname: "Baby Doe"
                            ktp: "5432109876"
                      price_detail:
                        type: object
                        properties:
                          total_price:
                            type: number
                            example: 6600000
                          tax:
                            type: number
                            example: 600000
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Can't find user with id 2"
                  data:
                    type: object
                    nullable: true
                    example: null
        404:
          description: Booking not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Booking with id 3 not found"
                  data:
                    type: object
                    nullable: true
                    example: null